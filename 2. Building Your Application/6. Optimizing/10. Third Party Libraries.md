源地址: https://nextjs.org/docs/app/building-your-application/optimizing/third-party-libraries

# Third Party Libraries (第三方库)

在 Next.js 中, **`@next/third-parties`** 是一个提供了一系列组件和实用程序的苦, 它可以改善应用程序中加载常用第三方库的性能和开发体验.

> **请注意**: `@next/third-parties` 是一个新的实验库, 目前仍在积极开发中. 我们目前正在努力添加更多第三方集成.

`@next/third-parties` 提供的所有第三方集成都经过了性能和易用性方面的优化.

---

## Getting Started (开始)

要开始, 需要先安装 `@next/third-parties` 库:

Terminal:

```bash
npm install @next/third-parties
```

---

## Google Third-Parties (谷歌的第三方库)

所有支持的谷歌第三方库都可以从 `@next/third-parties/google` 中导入.

### Google Tag Manager

`GoogleTagManager` 组件可用于为页面实例化 [Google Tag Manager Container](https://developers.google.com/tag-platform/tag-manager). 默认情况下, 它会在页面水合后获取原始的内联脚本.

要为所有路由加载 Google Tag Manager, 直接在根布局上包裹所有的组件:

app/layout.tsx:

```tsx
import { GoogleTagManager } from "@next/third-parties/google";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body>{children}</body>
      <GoogleTagManager gtmId="GTM-XYZ" />
    </html>
  );
}
```

针对一个路由增加 Google Tag Manager, 可以在 page 文件中包裹该组件:

app/page.tsx:

```tsx
import { GoogleTagManager } from "@next/third-parties/google";

export default function Page() {
  return <GoogleTagManager gtmId="GTM-XYZ" />;
}
```

#### Sending Events

`sendGTMEvent` 函数可通过使用 `dataLayer` 对象发送事件来跟踪页面上的用户交互. 要使用该函数, `<GoogleTagManager />` 组件必须包含在父布局 / 页面 / 组件 / 同一文件中.

app/page.js:

```tsx
"use client";

import { sendGTMEvent } from "@next/third-parties/google";

export function EventButton() {
  return (
    <div>
      <button
        onClick={() => sendGTMEvent({ event: "buttonClicked", value: "xyz" })}
      >
        Send Event
      </button>
    </div>
  );
}
```

请参阅 [Tag Manager 文档](https://developers.google.com/tag-platform/tag-manager/datalayer), 了解可传入函数的不同变量和事件.

#### Options

传递给 Google Tag Manager 的选项. 有关选项的完整列表, 请阅读 [Google Tag Manager 文档](https://developers.google.com/tag-platform/tag-manager/datalayer).

| Name            | Type     | Description                                          |
| --------------- | -------- | ---------------------------------------------------- |
| `gtmId`         | Required | 你的 GTM 容器 ID.                                    |
| `dataLayer`     | Optional | Data layer 数组用于实例化容器实例. 默认是一个空数组. |
| `dataLayerName` | Optional | Data layer 的名称. 默认是 `dataLayer`.               |
| `auth`          | Optional | 环境快照的权限参数 (gtm_auth).                       |
| `preview`       | Optional | 环境快照的预览参数(gtm_preview).                     |

### Google Maps Embed

#### Options

### YouTube Embed

#### Options
